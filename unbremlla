require "http"
require "json"
require "dotenv/load"

# 1. know user's location
pp "where are you located?"

user_location= gets.chomp.gsub("","%20")

#2. use API to find information about the location
maps_url="https://maps.googleapis.com/maps/api/geocode/json?address=" + user_location + "&key=" + ENV.fetch("GMAPS_KEY")

#3. attain API info
resp = HTTP.get(maps_url)

#4. make the response into string
raw_response = resp.to_s

#5. translate into ruby
parsed_response = JSON.parse(raw_response)

#6. find the lat and lng of the location
location = parsed_response.fetch("results").at(0).fetch("geometry").fetch("location")

lat = location.fetch("lat")
lng = location.fetch("lng")

#7. write the weather url using lat and lng
pirate_weather_api_key = ENV["PIRATE_WEATHER_API_KEY"]

pirate_weather_url = "https://api.pirateweather.net/forecast/" + pirate_weather_api_key + "/#{lat},#{lng}"

#8. attain info from url
raw_response = HTTP.get(pirate_weather_url)

#9. translate into ruby
parsed_response = JSON.parse(raw_response)

#10. find the temperature info
currently_temp = parsed_response.fetch("currently").fetch("temperature")


puts "The current temperature is " + currently_temp.to_s + "."
